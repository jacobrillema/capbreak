function renderNexrad(e,t){var n=Date.now();renderComplete=false;var r=0;for(var i=0;i<t.Symbology.RadialData.length;i++){var s=t.Symbology.RadialData[i];var o=0;var u=s.AngleDelta||1;var a=s.StartAngle;for(var f=0;f<s.ColorValues.length;f++){var l=s.ColorValues[f];if(l>0){var c=[];c.push([Math.cos(radians(a-90))*o*zoom+width/2,Math.sin(radians(a-90))*o*zoom+height/2]);c.push([Math.cos(radians(a-90+u))*o*zoom+width/2,Math.sin(radians(a-90+u))*o*zoom+height/2]);if(polygonReduce){while(f<s.ColorValues.length&&l==s.ColorValues[f+1]){o++;f++}}c.push([Math.cos(radians(a-90+u))*(o+1)*zoom+width/2,Math.sin(radians(a-90+u))*(o+1)*zoom+height/2]);c.push([Math.cos(radians(a-90))*(o+1)*zoom+width/2,Math.sin(radians(a-90))*(o+1)*zoom+height/2]);var h=null;if(transparency){var p=l<4?.2:1;var d=hexToRgb(colorTable[l]);var h="rgba("+d.r+", "+d.g+", "+d.b+", "+p+")"}else{h=colorTable[l]}if(groupRendering){addPolygon(e,c,h)}else{drawPolygon(e,c,h)}r++}o++}}if(groupRendering){renderPolygons(e)}return{polyCount:r,renderTimer:Date.now()-n}}function drawPolygon(e,t,n){e.beginPath();e.moveTo(t[0][0],t[0][1]);for(var r=1;r<t.length;r++){e.lineTo(t[r][0],t[r][1])}e.lineTo(t[0][0],t[0][1]);e.closePath();e.fillStyle=n;e.fill()}function addPolygon(e,t,n){var r=null;for(var i=0;i<polygonGroups.length;i++){if(polygonGroups[i].name!=null&&polygonGroups[i].name==n){r=i;break}}if(r==null){polygonGroups.push({name:n,data:[]});r=polygonGroups.length-1}polygonGroups[r].data.push(t)}function renderPolygons(e){for(var t=0;t<polygonGroups.length;t++){e.beginPath();var n=polygonGroups[t];for(var r=0;r<n.data.length;r++){var i=n.data[r];e.moveTo(i[0][0],i[0][1]);for(var s=1;s<i.length;s++){e.lineTo(i[s][0],i[s][1])}e.lineTo(i[0][0],i[0][1])}e.closePath();e.fillStyle=n.name;e.fill()}polygonGroups=[]}function findPos(e){var t=0,n=0;if(e.offsetParent){do{t+=e.offsetLeft;n+=e.offsetTop}while(e=e.offsetParent);return{x:t,y:n}}return undefined}function rgbToHex(e,t,n){if(e>255||t>255||n>255){throw"Invalid color component"}return(e<<16|t<<8|n).toString(16)}var mouseMove=false;var mouseEvent=null;var mouseElement=null;var badAngleDeltaCount=0;var zoom=1;var width=480;var height=480;var polygonReduce=true;var transparency=true;var groupRendering=true;var colorTable=["#000","#00EAEC","#01A0F6","#0000F6","#00FF00","#00C800","#009000","#FFFF00","#E7C000","#FF9000","#FF0000","#D60000","#C00000","#FF00FF","#9955C9","#FFF"];var nexradScans=[nx0,nx1,nx2,nx3,nx4,nx5,nx6,nx7,nx8,nx9,nx10,nx11,nx12];var totalRenderTime=0;var polygonGroups=[];for(var i=0;i<13;i++){$("body").append($("<canvas/>",{id:"nx"+i,style:"display: none;"}).attr("width",width).attr("height",height));var tmpContext=$("#nx"+i).get(0).getContext("2d");var renders=renderNexrad(tmpContext,nexradScans[i]);console.log(renders)}var currentScan=0;setInterval(function(){var e=currentScan>0?currentScan-1:12;hideElement(document.getElementById("nx"+e));showElement(document.getElementById("nx"+currentScan));currentScan=currentScan==12?0:currentScan+1},75);$("#canvas").mousemove(function(e){mouseMove=true;mouseElement=this;mouseEvent=e});setInterval(function(){if(mouseMove){mouseMove=false;var e=findPos(mouseElement);var t=mouseEvent.pageX-e.x;var n=mouseEvent.pageY-e.y;var r={x:t,y:n};var i={x:480,y:480};var s={x:t,y:i.y};r.length=Math.abs(s.y-r.y);s.length=Math.abs(s.x-i.x);var o=Math.atan(r.length/s.length);var u=0;if(t>width/2&&n<height/2){u=90-Math.ceil(degrees(o))}else if(t>width/2&&n>height/2){u=90+Math.ceil(degrees(o))}else if(t<width/2&&n>height/2){u=270-Math.ceil(degrees(o))}else{u=270+Math.ceil(degrees(o))}var a=Math.floor(Math.sqrt(Math.pow(s.length,2)+Math.pow(r.length,2))/2);console.log(u);console.log(a);var f=radar.Symbology.RadialData[u].ColorValues[a]+1;var l=radar.Descriptor["Threshold"+f];infoContext.clearRect(0,0,width,height);infoContext.fillText(l+" dBz",100,100)}},100)